@page "/data"
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@using SportStatisticsApp.Data
@using SportStatisticsApp.Models


<MudText>Hello Users @(_users?.Count??-1)</MudText>
<MudText>Hello Matches @(_matches?.Count??-1)</MudText>
<MudText>Hello Actions@(_matchActions?.Count??-1)</MudText>
@code {
    [Inject] private UserManager<ApplicationUser> _userManager { get; set; }
    [Inject] private IDbContextFactory<ApplicationDbContext> _dbContextFactory { get; set; }
    [Inject] private ILogger<DataView> _logger { get; set; }
    private List<ApplicationUser> _users ;
    private List<Match> _matches ;
    private List<MatchAction> _matchActions;
    protected override async Task OnInitializedAsync()
    {
        try
        {
            _users = await _userManager.Users
                .Include(user => user.MatchActions)
                .Include(user => user.MatchesPlayed)
                .ToListAsync();

            await using (var dbContext = await _dbContextFactory.CreateDbContextAsync())
            {
                _matches = await dbContext.Matches
                    .Include(match => match.Players)
                    .Include(match => match.Actions)
                    .ToListAsync();

                _matchActions = await dbContext.MatchActions
                    .Include(ma => ma.Player)
                    .Include(ma => ma.Match)
                    .ToListAsync();
            }
        }
        catch (Exception ex)
        {
            _logger.LogCritical($"ERROR IN DATA VIEW {ex}");
        }

    }
    

}
